<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- Meta, title, CSS, favicons, etc. -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Gentelella Alela! | </title>

    
    <link href="font.css" rel="stylesheet">

     <!-- Bootstrap -->
     <link href="vendors/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
     <!-- Font Awesome -->
     <link href="vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    
     <!-- PNotify -->
     <link href="vendors/pnotify/dist/pnotify.css" rel="stylesheet">
     <link href="vendors/pnotify/dist/pnotify.buttons.css" rel="stylesheet">
     <link href="vendors/pnotify/dist/pnotify.nonblock.css" rel="stylesheet">
   
    <!-- Animate.css -->
    <link href="vendors/animate.css/animate.min.css" rel="stylesheet">

    <!-- jQuery -->
    <script src="vendors/jquery/dist/jquery.min.js"></script>
    <!-- Bootstrap -->
    <script src="vendors/bootstrap/dist/js/bootstrap.min.js"></script>
  
  
   
    <!-- PNotify -->
    <script src="vendors/pnotify/dist/pnotify.js"></script>
    <script src="vendors/pnotify/dist/pnotify.buttons.js"></script>
   

   

    <!-- Custom Theme Style -->
    <link href="build/css/custom.min.css" rel="stylesheet">

   
  </head>

  <body class="login" style="font-family: 'Saysettha OT'">
    <div align="right">
            <div id="notificationpanel"></div>
            <div id="notificationpanellist"></div>
            <div id="errorpanel"></div>
            <div id="errorpanellist"></div>
    </div>
     
    <div>
      <a class="hiddenanchor" id="signup"></a>
      <a class="hiddenanchor" id="signin"></a>

      <div class="login_wrapper">
        <div class="animate form login_form">
          <section class="login_content">
            <form >
              <h1>Task Managerment</h1>
              <div>
                <input id="username" type="text" class="form-control" placeholder="Username" required="" />
              </div>
              <div>
                <input id="password" type="password" class="form-control" placeholder="Password" required="" />
              </div>
              <div>
                <a class="btn btn-default submit_login" >Log in</a>
                
              </div>
              
              <div class="clearfix"></div>
             
              <div class="separator">
                <p class="change_link">ປ່ຽນລະຫັດຜ່ານ :
                    <a href="#signup" class="to_register"> Chang password </a>
                  </p>
              </div>
              
    
            </form>
          </section>
        </div>
        
        <div id="register" class="animate form registration_form">
            <section class="login_content">
              <form>
                <h1>Chang password</h1>
                <div>
                  <input id="User_change" type="text" class="form-control" placeholder="Username" required="" />
                </div>
                <div>
                  <input id="Old_password" type="password" class="form-control" placeholder="Old Password" required="" />
                </div>
                <div>
                  <input id ="New_password"type="password" class="form-control" placeholder="New Password" required="" />
                </div>
                <div>
                  <a class="btn btn-default chang_password">Change Password</a>
                </div>
  
                <div class="clearfix"></div>
  
                <div class="separator">
                  <p class="change_link">ກັບຄືນໜ້າ :
                    <a href="#signin" class="to_register"> Log in </a>
                  </p>
                  
                  <div class="clearfix"></div>
                  <br />
                 
                  
                </div>
              </form>
            </section>
          </div>
         
      
          
      </div>
     
    </div>
  </body>
</html>

<script type="text/javascript">

      
   

   
    $('.submit_login').click(function () {

       


       if($('#username').val()==''){
            
            new PNotify({
            title: 'ແຈ້ງເຕືອນ',
            text: 'ຂໍ້ມູບໍ່ຄົບ ! ກະລຸນາປ້ອມຂໍ້ມູນຜູ້ໃຊ້.',
            hide: false,
            
            styling: 'bootstrap3'
            });
           
        }else if($('#password').val()==''){
                
            new PNotify({
            title: 'ແຈ້ງເຕືອນ',
            text: 'ຂໍ້ມູບໍ່ຄົບ ! ກະລຸນາປ້ອມຂໍ້ມູນລະຫັດຜ່ານ.',
            hide: false,
            
            styling: 'bootstrap3'
            });
           
        }else{
            new PNotify({
            title: 'ແຈ້ງເຕືອນ',
            text: 'ກຳລັງປະມວນຜົນ...',
            type: 'success',
            
            styling: 'bootstrap3'
        });
            window.location.replace("User/desbord_user.html");
            login()
            
        }
    });

    


    $('.chang_password').click(function () {

        if($('#User_change').val()==''){
            new PNotify({
            title: 'ແຈ້ງເຕືອນ',
            text: 'ຂໍ້ມູບໍ່ຄົບ ! ກະລຸນາປ້ອມຂໍ້ມູນຜູ້ໃຊ້.',
            hide: false,
            
            styling: 'bootstrap3'
            });
        }else if($('#Old_password').val()==''){
                
            new PNotify({
            title: 'ແຈ້ງເຕືອນ',
            text: 'ຂໍ້ມູບໍ່ຄົບ ! ກະລຸນາປ້ອມຂໍ້ມູນລະຫັດຜ່ານເກົ່າ.',
            hide: false,
            
            styling: 'bootstrap3'
            });
           
        }else if($('#New_password').val()==''){
                
            new PNotify({
            title: 'ແຈ້ງເຕືອນ',
            text: 'ຂໍ້ມູບໍ່ຄົບ ! ກະລຸນາປ້ອມຂໍ້ມູນລະຫັດຜ່ານໃໝ່.',
            hide: false,
            
            styling: 'bootstrap3'
            });
               
        }else{
            new PNotify({
            title: 'ແຈ້ງເຕືອນ',
            text: 'ກຳລັງປະມວນຜົນ...',
            hide: false,
            
            styling: 'bootstrap3'
        });
            $('#myAlert_change').hide('true');
            login()
            saveClient()
            getClient()
        }
    });
          

  

    
    
    


  // DEFAULT FORMAT FOR CLIENT
      var _client = {
          accessedtime: new Date(),
          clientip: "",
          data: {},
          gui: "",
          lastupdate: "",
          loginip: "",
          logintime: "",
          logintoken: "",
          timeout: 86400,
          username: "",
      };
  
      function login() {
          var user = $('#username').val();
          var pass = $('#password').val();
          // all request data 
          _client.data.user.username = user;
          _client.data.user.password = pass;
          _client.data.command='login';
          // command list : 
          // login 
          // forgotpassword
          // forgotusername
          // changepassword 
          // profile
          // createuser
          // updateuser
          // verticalusersline
          // 
          // createdoc
          // updatedoc
          // createjob
          // updatejob
          // doclist
          // joblist 
          // approvaluserlist
          // pendingapprovelist
          // 
  
  
  
  
          // HOW TO SET TO SERVER
          $.ajax({
              type: 'POST', // METHOD 
              url: '/user', // PATH  or /admin
              contentType: 'application/json; charset=utf-8',
              dataType: 'json',
              data: _client, // DATA TO SEND
              success: function (data) {
                  _client=data;
                  bindData();
                  $('#notificationpanel').html = "<p>" +_client.data.message + "</p>";
                  $("#notificationpanel").fadeIn("slow",function(){
                      $('#notificationpanel').fadeOut( "slow" );
                  });
  
                  $('#notificationpanellist').append("<p>" +_client.data.message + "</p>");
                  
              },
              failure: function (data) {
                  _client=data;
  
                  $('#errorpanel').html = "<p>" + _client.data.errormessage + "</p>";
                  $('#errorpanel').fadeIn("slow",function(){
                      $('#errorpanel').fadeOut( "slow" );
                  });
                  // 
                  $('#errorpanellist').append = ("<p>" + _client.data.errormessage + "</p>");
                  console.log(_client.data.message);
              }
          });
      }

      function bindData(){
          var username=_client.username;
          var ip = _client.loginip;
          var logintime=_client.logintime;
          $("#loginusername").text("welcome: "+username);
          $("#loginip").text("IP: "+ip);
          $("#logintime").text("login time: "+logintime);
      }

      function saveClient() {
          localStorage.setItem('taskmanagerclient', JSON.stringify(_client));
      }
  
      function getClient() {
          // check if it is set
          try {
              _client = JSON.parse(localStorage.getItem('taskmanagerclient'));
          } catch (error) {
              console.log('localstorage empty');
              // reset all data when local storage is empty
              _client = {
                  accessedtime: new Date(),
                  clientip: "",
                  data: {},
                  gui: "",
                  lastupdate: "",
                  loginip: "",
                  logintime: "",
                  logintoken: "",
                  timeout: 86400,
                  username: "",
              };
              window.location.replace("../index.html");
  
          }
  
      }
  </script>
